<!-- resource/static/admin/table-manager.html -->
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω b√†n ƒÉn</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/table-manager.css">

</head>
<body>
    <!-- Ti√™u ƒë·ªÅ -->
    <div class="header">
        <button class="menu-btn" onclick="toggleSidebar()">&#9776;</button>
        <h1>Qu·∫£n l√Ω b√†n ƒÉn</h1>

        <span id="headerClock" class="header-clock" aria-label="Gi·ªù hi·ªán t·∫°i"></span>

        <div class="user-info" id="userInfo"></div>
    </div>

    <!-- Thanh b√™n -->
    <div class="sidebar-container"></div>

    <!-- Th√™m b√†n (d√†nh cho admin) -->
    <div id="adminActions" class="admin-actions" style="text-align: end; margin-right: 20px; display: none;">
            <button class="btn" onclick="showAddTable()">‚ûï Th√™m b√†n</button>
    </div>

    <!-- B·ªô l·ªçc b√†n -->
    <div style="text-align: center; margin: 15px;">
        <label for="tableFilter"><strong>L·ªçc b√†n:</strong></label>
        <select id="tableFilter" onchange="loadTables()" style="padding: 6px; font-size: 16px;">
            <option value="ALL">T·∫•t c·∫£</option>
            <option value="Tr·ªëng">Tr·ªëng</option>
            <option value="ƒêang ph·ª•c v·ª•">ƒêang ph·ª•c v·ª•</option>
            <option value="Ch·ªù thanh to√°n">Ch·ªù thanh to√°n</option>
        </select>
    </div>

    <!-- Danh s√°ch b√†n -->
    <div class="table-grid" id="tableContainer"></div>

    <!-- Modal cho chi ti·∫øt ƒë∆°n h√†ng -->
    <div id="modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <h3>Chi ti·∫øt ƒë∆°n</h3>
            <div id="modalBody"></div>
        </div>
    </div>

    <!-- Modal th√™m b√†n m·ªõi -->
    <div id="addTableModal" class="modal" style="display:none;">
      <div class="modal-content">
        <span class="close" onclick="closeAddTableModal()">&times;</span>
        <h2>Th√™m b√†n m·ªõi</h2>

        <div class="form-group">
          <label for="newTableNumber">S·ªë b√†n</label>
          <input type="number" id="newTableNumber" placeholder="Nh·∫≠p s·ªë b√†n" />
        </div>

        <div class="form-group">
          <label for="newTableCapacity">S·ª©c ch·ª©a</label>
          <input type="number" id="newTableCapacity" placeholder="Nh·∫≠p s·ª©c ch·ª©a" />
        </div>

        <div class="form-error" id="addTableError"></div>

        <div style="text-align:right; margin-top: 12px;">
          <button class="btn primary" onclick="submitNewTable()">L∆∞u</button>
        </div>
      </div>
    </div>

    <!-- Modal c·∫≠p nh·∫≠t b√†n -->
    <div id="editTableModal" class="modal" style="display:none;">
      <div class="modal-content">
        <span class="close" onclick="closeEditTableModal()">&times;</span>
        <h2>C·∫≠p nh·∫≠t b√†n</h2>

        <div class="form-group">
          <label for="editTableNumber">S·ªë b√†n</label>
          <input type="text" id="editTableNumber" readonly style="background-color:#f3f4f6;" />
        </div>

        <div class="form-group">
          <label>QR Code</label>
          <div id="editQrCodePreview" style="text-align:center;">
            <img id="editQrCodeImg" src="" alt="QR Code" 
                style="width:120px;height:120px;object-fit:contain;border:1px solid #ccc;border-radius:8px;cursor:pointer;display:none;"
                onclick="openQrModal(this.src)">
          </div>
        </div>

        <div class="form-group">
          <label for="editStatus">Tr·∫°ng th√°i</label>
          <select id="editStatus">
            <option value="Tr·ªëng">Tr·ªëng</option>
            <option value="ƒêang ph·ª•c v·ª•">ƒêang ph·ª•c v·ª•</option>
            <option value="Ch·ªù thanh to√°n">Ch·ªù thanh to√°n</option>
          </select>
        </div>

        <div class="form-group">
          <label for="editCapacity">S·ª©c ch·ª©a</label>
          <input type="number" id="editCapacity" />
        </div>

        <div class="form-error" id="editTableError"></div>

        <div style="text-align:right; margin-top: 12px;">
          <button class="btn primary" onclick="submitEditTable()">L∆∞u</button>
        </div>
      </div>
    </div>

    <!-- Modal ph√≥ng to QR -->
    <div id="qrPreviewModal" class="modal" style="display:none;">
      <div class="modal-content" style="max-width:400px;text-align:center;">
        <span class="close" onclick="closeQrModal()">&times;</span>
        <img id="qrPreviewImg" src="" alt="QR" style="width:300px;height:300px;border-radius:10px;">
      </div>
    </div>

    <!-- Modal s·ª≠a m√≥n trong ƒë∆°n -->
    <div id="editModal" class="modal hidden">
      <div class="modal-backdrop" onclick="closeEditModal()"></div>
      <div class="modal-body">
        <h3>S·ª≠a m√≥n</h3>
        <label>S·ªë l∆∞·ª£ng</label>
        <input type="number" id="editQuantity" min="1">

        <label>Ghi ch√∫</label>
        <textarea id="editNotes"></textarea>

        <div class="modal-actions">
          <button onclick="closeEditModal()">H·ªßy</button>
          <button onclick="saveEdit()">L∆∞u</button>
        </div>
      </div>
    </div>

    <!-- Modal x√°c nh·∫≠n thanh to√°n -->
    <div id="payModal" class="modal" style="display:none;">
      <div class="modal-content" style="max-width:720px;">
        <span class="close" onclick="closePayModal()">&times;</span>
        <h2>X√°c nh·∫≠n thanh to√°n</h2>

        <div id="payInfo" style="margin:8px 0 12px;color:#374151;"></div>

        <div class="table-responsive" style="max-height:320px;overflow:auto;border:1px solid #eee;border-radius:8px;">
          <table style="width:100%;border-collapse:collapse;">
            <thead>
              <tr style="background:#f8fafc;">
                <th style="text-align:left;padding:10px;border-bottom:1px solid #eee;">M√≥n</th>
                <th style="text-align:center;padding:10px;border-bottom:1px solid #eee;">SL</th>
                <th style="text-align:right;padding:10px;border-bottom:1px solid #eee;">ƒê∆°n gi√°</th>
                <th style="text-align:right;padding:10px;border-bottom:1px solid #eee;">Th√†nh ti·ªÅn</th>
              </tr>
            </thead>
            <tbody id="payItems"></tbody>
          </table>
        </div>

        <div id="paySummary" style="text-align:right;margin-top:12px;font-weight:600;"></div>

        <div style="margin:12px 0;">
          <label for="payVoucher"><strong>Voucher:</strong></label>
          <input type="text" id="payVoucher" placeholder="Nh·∫≠p m√£ gi·∫£m gi√°" style="padding:6px;width:200px;">
          <button class="btn" onclick="applyVoucher()">√Åp d·ª•ng</button>
          <span id="payVoucherMsg" style="margin-left:8px;font-size:13px;color:#6b7280;"></span>
        </div>

        <div id="payError" class="form-error" style="display:none;margin-top:8px;"></div>

        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:14px;">
          <button class="btn" onclick="closePayModal()">H·ªßy</button>
          <button class="btn primary" id="btnConfirmPay" onclick="confirmPay()">X√°c nh·∫≠n thanh to√°n</button>
          <button class="btn" id="btnViewInvoice" style="display:none;" onclick="viewInvoice()">Xem/In h√≥a ƒë∆°n</button>
        </div>
      </div>
    </div>

    <!-- Modal Th√™m m√≥n v√†o b√†n -->
    <div id="openAddItemModal" class="modal" style="display:none;">
      <div class="modal-content modal-content--lg">
        <span class="close" onclick="closeAddItemModal()">&times;</span>
        <h2>Th√™m m√≥n cho B√†n <span id="addItemTableNumber"></span></h2>
        
        <!-- Tab: M√≥n ƒÉn / Combo -->
        <div style="display: flex; gap: 12px; margin-bottom: 16px; border-bottom: 2px solid var(--border); padding-bottom: 12px;">
          <button class="tab-btn active" onclick="switchTab('items')" id="tabItems">
            üçΩÔ∏è M√≥n ƒÉn
          </button>
          <button class="tab-btn" onclick="switchTab('combos')" id="tabCombos">
            üéÅ Combo
          </button>
        </div>
        
        <!-- Category Filter (ch·ªâ cho m√≥n ƒÉn) -->
        <div class="menu-category-filter" id="categoryFilter" style="display:flex;">
          <!-- JS render categories -->
        </div>
        
        <!-- Menu Items Grid -->
        <div class="menu-items-grid" id="menuItemsGrid">
          <!-- JS render items/combos -->
        </div>
        
        <!-- Selected Items Cart -->
        <div class="selected-items-section">
          <h3 style="margin: 0 0 12px; font-size: 16px; color: var(--text);">
            üõí Gi·ªè h√†ng (<span id="cartCount">0</span> m√≥n)
          </h3>
          <div id="selectedItemsList" class="selected-items-list">
            <p style="text-align:center; color:var(--muted); padding:20px;">Ch∆∞a ch·ªçn m√≥n n√†o</p>
          </div>
          <div class="order-summary-box">
            <div class="total">T·ªïng t·∫°m t√≠nh: <span id="tempTotal">0 VND</span></div>
          </div>
        </div>
        
        <div id="addItemError" class="form-error"></div>
        
        <div style="text-align:right; margin-top:16px; display:flex; gap:10px; justify-content:flex-end;">
          <button class="btn secondary" onclick="closeAddItemModal()">H·ªßy</button>
          <button class="btn primary" onclick="submitAddItemsToTable()">
            ‚úÖ X√°c nh·∫≠n th√™m
          </button>
        </div>
      </div>
    </div>

<script>
    fetch('/admin/sidebar.html')
      .then(r => r.text())
      .then(html => {
        document.querySelector('.sidebar-container').innerHTML = html;
        loadSidebarUser();
        initSidebarSubmenu();
      });
  </script>

<script src="js/config.js"></script>
<script src="js/auth-fetch.js"></script>
<script src="js/common.js"></script>
<script src="js/table-manager.js"></script>


<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.6.1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</body>
</html>
